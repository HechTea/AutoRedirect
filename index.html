<head>
	<style>
		body {
			font-family: Verdana,sans-serif;
		}
		span {
			font-size: 24px;
		}
		.red {
			color: red;
		}
		.OnButt {
			height: 50px;
			width: 70px;
			font-size: 24px;
		}
		.OffButt {
			height: 50px;
			width: 70px;
			font-size: 24px;
		}
		.OnButt.ActiveButt {
			background-color: #84ff6e;
		}
		.OffButt.ActiveButt {
			background-color: #ff6e6e;
		}
	</style>
	<script>
		function onoffclick(e) {
			var v = 0;
			if (e.target.innerText == "on") {
				v = 1;
			} else if  (e.target.innerText == "on") {
				v = 0;
			}
			localStorage.setItem("autoRedirect", v);
			_updateButt(v);
		}
		function _updateButt(v) {
			document.querySelector(".ActiveButt").classList.remove("ActiveButt");
			if (v == 1) {
				document.querySelector(".OnButt").classList.add("ActiveButt");
			} else if (v == 0) {
				document.querySelector(".OffButt").classList.add("ActiveButt");
			}
		}
	</script>
	<script>
		var argString = window.location.href.replace(window.location.origin + window.location.pathname + "?", "");
		var args = argString.split("&url=");
		var siteOption = args[0];
		var rawLink = args[1] || "";
		var noFBJunkLink = rawLink.split("&fbclid=")[0];
		// perhaps some other stuff.  we'll see.
		var cleanLink = noFBJunkLink;
		
		var autoRedirect = false;
		var savedRedirectValue = localStorage.getItem("autoRedirect");
		if (savedRedirectValue == null) {
			localStorage.setItem("autoRedirect", "0");
		} else if (savedRedirectValue == "1") {
			autoRedirect = true;
		}
		
		window.addEventListener('load', function () {
			if ( window.location.href.startsWith(window.location.origin + window.location.pathname + "?") 
			     && (args[1] || "").length > 0 ) 
			{
				var url = "";
				switch(siteOption) {
					case "site=esix":
						url = "https://e621.net";
						break;
					case "site=fa":
						url = "https://furaffinity.net";
						break;
					default:
						url = "https://www.google.com/search?"
				}
				if (!args[1].startsWith("/")) url += "/";
				url += cleanLink;
				url = decodeURIComponent(url);
				
				if (autoRedirect)
					window.location.replace(url);
				document.querySelector("#manual-link").href = url;
				document.querySelector("#manual-link").innerText = url;
			} else {
				document.querySelector("#text").style.display = "none";
				document.querySelector("#instruction-div").style.display = "";
			}
		})
	</script>
</head>
<body>
	<a id="manual-link" href=""></a>
	<p id="text">Redirecting...</p>
	<div id="instruction-div" style="display:none;">
		<span>請在網址輸入正確的格式，如：</span>
		<br>
		<span>https://hechtea.github.io/AutoRedirect/</span>
		<span class="red">?</span>
		<span>site=[支援的網站]</span>
		<span class="red">&url=</span>
		<span>你想要去的網址，去掉他的域名</span>
		<br><br>
		<span>[支援的網站] 包含：</span>
		<br>
		<span>esix	->  e621.net</span><br>
		<span>fa	->  furaffinity.net</span><br>
		<span>其他有想到再說</span>
		<br><br>
		<span>範例：</span>
		<br>
		<span>我想去 https://www.furaffinity.net/view/29162306/ </span><br>
		<span>那麼就打</span>
		<a href="https://hechtea.github.io/AutoRedirect/?site=fa&url=/view/29162306/">
			https://hechtea.github.io/AutoRedirect/?site=fa&url=/view/29162306/
		</a>
		<br><br>
	</div>
	<div>
		<span>開啟自動轉跳？</span>
		<button class="OnButt" onclick="onoffclick(this)">On</button>
		<button class="OffButt" onclick="onoffclick(this)">Off</button>
	</div>
</body>
